webpackJsonp([7],{"/vVK":function(a,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=t("Xxa5"),n=t.n(o),r=t("Aaao"),l=t("mOxS"),i=t("P9l9"),s=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(a[o]=t[o])}return a};function d(a){return function(){var e=a.apply(this,arguments);return new Promise(function(a,t){return function o(n,r){try{var l=e[n](r),i=l.value}catch(a){return void t(a)}if(!l.done)return Promise.resolve(i).then(function(a){o("next",a)},function(a){o("throw",a)});a(i)}("next")})}}var c={data:function(){return{loading:!1,restaurant_id:this.$route.query.id||"",baseUrl:"//elm.cangdu.org/img/",categoryFood:{categorySelect:"",newCategory:"",newInfo:""},categoryList:[],isAdd:!1,addFoodData:{name:"",huodong:"",description:"",imageUrl:null,tedian:"",guige:"1",packing_fee:0,money:20},tedianList:[{label:"新品",value:"新品"},{label:"招牌",value:"招牌"}],addTable:[{name:"默认",m1:1,m2:20}],dialogData:{name:"",m1:0,m2:20},addDialog:!1,category_id:null,spec:null,tedianArr:[],rules:{name:[{required:!0,message:"请输入食品名称",trigger:"blur"}],imageUrl:[{required:!0,message:"请上传图片",trigger:"blur"}]}}},components:{indexHeader:r.a,indexFooter:l.default},methods:{foodSuccess:function(a,e){a.status&&(1===a.status?this.addFoodData.imageUrl=a.image_path:this.$message.error("上传失败"),console.log(e))},foodBefore:function(a){var e="image/jpeg"===a.type||"image/png"===a.type,t=a.size/1024/1024<2;return e||this.$message.error("上传图片格式只能是png或者jpg"),t||this.$message.error("图片大小超过2M"),e&&t},del:function(a){this.addTable.splice(a,1)},addData:function(a){""!==this.dialogData.name&&this.dialogData.name?(console.log(this.dialogData),this.addTable.push(s({},this.dialogData)),this.dialogData.name="",this.dialogData.m1=0,this.dialogData.m2=20):this.$message.error("规格不能为空"),this.addDialog=!1},isShopId:function(){var a=this;this.restaurant_id||this.$confirm("当前尚未选择商铺，是否先返回选择商铺?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$router.push("/dataManage/shopList")}).catch(function(){a.restaurant_id=Math.ceil(10*Math.random())})},getCategoryData:function(){var a=this;return d(n.a.mark(function e(){var t;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.v)(a.restaurant_id);case 2:t=e.sent,console.log(t),t.status&&(t.category_list.map(function(a,e){a.value=e,a.label=a.name}),a.categoryList=t.category_list);case 5:case"end":return e.stop()}},e,a)}))()},addNewCategory:function(){var a=this;return d(n.a.mark(function e(){var t;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.categoryFood.newCategory){e.next=4;break}a.$message.error("新增食品种类不能为空"),e.next=13;break;case 4:if(a.categoryFood.newInfo){e.next=8;break}a.$message.error("新增食品详情不能为空"),e.next=13;break;case 8:return a.loading=!0,e.next=11,Object(i.a)(a.categoryFood.newCategory,a.categoryFood.newInfo,a.restaurant_id);case 11:(t=e.sent).status?(a.loading=!1,a.$message.success("添加新食品分类成功！"),a.getCategoryData(),a.categoryFood.newCategory="",a.categoryFood.newInfo=""):(a.loading=!1,a.$message.error(t.message));case 13:case"end":return e.stop()}},e,a)}))()},addNewFood:function(a){var e=this;this.$refs[a].validate(function(a){a?e.addFunc():console.log("错误")})},selected:function(a){this.category_id=this.categoryList[a].id},tedianFunc:function(a){switch(console.log(a),a){case"新品":this.tedianArr.push({value:"新",label:"新品"});break;case"招牌":this.tedianArr.push({value:"招",label:"招牌"})}console.log(this.tedianArr)},addFunc:function(){var a=this;return d(n.a.mark(function e(){var t,o,r;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"1"===a.addFoodData.guige?((t=[]).push({specs:"默认",packing_fee:a.addFoodData.packing_fee,price:a.addFoodData.money}),a.spec=t):(o=[],a.addTable.forEach(function(a,e){o.push({specs:a.name,packing_fee:a.m1,price:a.m2})}),a.spec=o),a.loading=!0,e.next=4,Object(i.b)(a.restaurant_id,a.category_id,a.addFoodData.name,a.addFoodData.imageUrl,a.spec,a.addFoodData.description,a.addFoodData.huodong,a.tedianArr);case 4:(r=e.sent).status?(a.$message.success("添加食品成功"),a.loading=!1,a.resetForm()):(a.$message.error(r.message),a.loading=!1);case 6:case"end":return e.stop()}},e,a)}))()},resetForm:function(){this.$refs.foodForm.resetFields()}},mounted:function(){this.isShopId(),this.getCategoryData()}},u={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"homeRight"},[t("index-header"),a._v(" "),t("el-main",[t("div",{staticClass:"border"},[t("h4",{staticClass:"tc h4"},[a._v("\n        选择食品种类\n      ")]),a._v(" "),t("el-form",{ref:"categoryForm",staticClass:"w50 bor1",attrs:{model:a.categoryFood,"label-width":"110px"}},[t("el-form-item",{staticClass:"p10",attrs:{label:"食品种类"}},[t("el-select",{staticClass:"w100",attrs:{placeholder:"请选择"},on:{change:a.selected},model:{value:a.categoryFood.categorySelect,callback:function(e){a.$set(a.categoryFood,"categorySelect",e)},expression:"categoryFood.categorySelect"}},a._l(a.categoryList,function(a,e){return t("el-option",{key:e,attrs:{label:a.label,value:a.value}})}),1)],1),a._v(" "),t("el-collapse-transition",[a.isAdd?t("div",{staticClass:"bg1 p10 transition-box"},[t("el-form-item",{attrs:{label:"食品种类"}},[t("el-input",{attrs:{placeholder:"请输入食品种类"},model:{value:a.categoryFood.newCategory,callback:function(e){a.$set(a.categoryFood,"newCategory",e)},expression:"categoryFood.newCategory"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"种类描述"}},[t("el-input",{attrs:{placeholder:"请输入种类描述"},model:{value:a.categoryFood.newInfo,callback:function(e){a.$set(a.categoryFood,"newInfo",e)},expression:"categoryFood.newInfo"}})],1),a._v(" "),t("el-form-item",{staticClass:"mb10",attrs:{label:""}},[t("el-button",{attrs:{type:"primary",loading:a.loading},on:{click:a.addNewCategory}},[a._v(a._s(a.loading?"添加中":"添加"))])],1)],1):a._e()]),a._v(" "),t("div",{staticClass:"bot",on:{click:function(e){a.isAdd=!a.isAdd}}},[a.isAdd?t("i",{staticClass:"el-icon-arrow-up"}):t("i",{staticClass:"el-icon-arrow-down"}),a._v("\n          添加食品种类\n        ")])],1)],1),a._v(" "),t("div",{staticClass:"border"},[t("h4",{staticClass:"tc h4"},[a._v("\n        添加食品\n      ")]),a._v(" "),t("el-form",{ref:"foodForm",staticClass:"bor1 w50 p21",attrs:{model:a.addFoodData,rules:a.rules,"label-width":"110px"}},[t("el-form-item",{attrs:{label:"食品名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入食品名称"},model:{value:a.addFoodData.name,callback:function(e){a.$set(a.addFoodData,"name",e)},expression:"addFoodData.name"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"食品活动"}},[t("el-input",{attrs:{placeholder:"请输入食品活动"},model:{value:a.addFoodData.huodong,callback:function(e){a.$set(a.addFoodData,"huodong",e)},expression:"addFoodData.huodong"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"食品详情"}},[t("el-input",{model:{value:a.addFoodData.description,callback:function(e){a.$set(a.addFoodData,"description",e)},expression:"addFoodData.description"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"上传食品图片",prop:"imageUrl"}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:"//elm.cangdu.org/v1/addimg/food","show-file-list":!1,"on-success":a.foodSuccess,"before-upload":a.foodBefore}},[a.addFoodData.imageUrl?t("img",{attrs:{src:a.baseUrl+a.addFoodData.imageUrl}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),a._v(" "),t("el-form-item",{attrs:{label:"食品特点"}},[t("el-select",{attrs:{placeholder:"请选择食品特点"},on:{change:a.tedianFunc},model:{value:a.addFoodData.tedian,callback:function(e){a.$set(a.addFoodData,"tedian",e)},expression:"addFoodData.tedian"}},a._l(a.tedianList,function(a,e){return t("el-option",{key:e,attrs:{label:a.label,value:a.value}})}),1)],1),a._v(" "),t("el-form-item",{attrs:{label:"食品规格"}},[t("el-radio",{attrs:{label:"1"},model:{value:a.addFoodData.guige,callback:function(e){a.$set(a.addFoodData,"guige",e)},expression:"addFoodData.guige"}},[a._v("单规格")]),a._v(" "),t("el-radio",{attrs:{label:"2"},model:{value:a.addFoodData.guige,callback:function(e){a.$set(a.addFoodData,"guige",e)},expression:"addFoodData.guige"}},[a._v("多规格")])],1),a._v(" "),"1"===a.addFoodData.guige?[t("el-form-item",{attrs:{label:"包装费"}},[t("el-input-number",{attrs:{size:"small",min:0},model:{value:a.addFoodData.packing_fee,callback:function(e){a.$set(a.addFoodData,"packing_fee",e)},expression:"addFoodData.packing_fee"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"价格"}},[t("el-input-number",{attrs:{size:"small",min:0},model:{value:a.addFoodData.money,callback:function(e){a.$set(a.addFoodData,"money",e)},expression:"addFoodData.money"}})],1)]:[t("p",{staticClass:"tc"},[t("el-button",{attrs:{type:"primary"},on:{click:function(e){a.addDialog=!0}}},[a._v("\n              添加规格\n            ")])],1),a._v(" "),t("el-table",{staticStyle:{"margin-top":"10px"},attrs:{data:a.addTable,border:"",stripe:""}},[t("el-table-column",{attrs:{label:"规格",prop:"name"}}),a._v(" "),t("el-table-column",{attrs:{label:"包装费",prop:"m1"}}),a._v(" "),t("el-table-column",{attrs:{label:"价格",prop:"m2"}}),a._v(" "),t("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:a._u([{key:"default",fn:function(e){return[t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return a.del(e.$index)}}},[a._v("\n                  删除\n                ")])]}}])})],1)],a._v(" "),t("p",{staticClass:"tc mt10"},[t("el-button",{attrs:{type:"primary",loading:a.loading},on:{click:function(e){return a.addNewFood("foodForm")}}},[a._v("确定添加")])],1)],2)],1)]),a._v(" "),t("index-footer"),a._v(" "),t("el-dialog",{attrs:{title:"添加规格",visible:a.addDialog,width:"500px"},on:{"update:visible":function(e){a.addDialog=e}}},[t("el-form",{attrs:{model:a.dialogData,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"规格"}},[t("el-input",{model:{value:a.dialogData.name,callback:function(e){a.$set(a.dialogData,"name",e)},expression:"dialogData.name"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"包装费"}},[t("el-input-number",{attrs:{size:"small",min:0},model:{value:a.dialogData.m1,callback:function(e){a.$set(a.dialogData,"m1",e)},expression:"dialogData.m1"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"价格"}},[t("el-input-number",{attrs:{size:"small",min:0},model:{value:a.dialogData.m2,callback:function(e){a.$set(a.dialogData,"m2",e)},expression:"dialogData.m2"}})],1)],1),a._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:function(e){return a.addData(a.dialogData)}}},[a._v("添加")]),a._v(" "),t("el-button",{on:{click:function(e){a.addDialog=!1}}},[a._v("取消")])],1)],1)],1)},staticRenderFns:[]};var g=t("VU/8")(c,u,!1,function(a){t("YFLc")},null,null);e.default=g.exports},YFLc:function(a,e){}});