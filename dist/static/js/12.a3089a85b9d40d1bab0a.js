webpackJsonp([12],{IVvI:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("Xxa5"),a=n.n(o),s=n("Aaao"),r=n("mOxS"),i=n("P9l9"),l=n("NYxO");function c(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function o(a,s){try{var r=t[a](s),i=r.value}catch(e){return void n(e)}if(!r.done)return Promise.resolve(i).then(function(e){o("next",e)},function(e){o("throw",e)});e(i)}("next")})}}var u={data:function(){return{imgUrl:"//elm.cangdu.org/img/",shopList:[],indexPagination:1,pageNum:0,offset:0,limit:50,shopData:[],total:0,loading:!0,editDialog:!1,shopInfo:{},oldShopInfo:{},selectCategory:[],selectData:[],editing:!1}},computed:(Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e})({},Object(l.c)(["userinfo"])),components:{indexHeader:s.a,indexFooter:r.default},methods:{editShop:function(e,t){this.editDialog=!0,this.oldShopInfo={name:e.name,address:e.address,description:e.description,phone:e.phone,imagePath:e.image_path,category:e.category},console.log(this.oldShopInfo),this.shopInfo=e,this.selectCategory=e.category.split("/"),console.log(this.selectCategory),console.log(e,t)},removeShop:function(e,t){console.log(e,t),this.userinfo&&"超级管理员"===this.userinfo.admin?this.delShop(e.id):this.$message.error("对不起，您没有删除店铺的权限！")},delShop:function(e){var t=this;return c(a.a.mark(function n(){var o;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(i.q)(e);case 2:o=t.sent,console.log(o);case 4:case"end":return t.stop()}},n,t)}))()},replaceShop:function(e,t){console.log(e,t),this.$router.push({path:"/addData/addFood",query:{id:e.id}})},changeSize:function(e){this.limit=e},changeCurrent:function(e){this.pageNum=e-1},getShopData:function(){var e=this;return c(a.a.mark(function t(){var n;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,e.offset=e.limit*e.pageNum,t.next=4,Object(i.A)(31.22967,121.4762,e.offset,e.limit);case 4:(n=t.sent)&&(e.loading=!1,e.shopData=n);case 6:case"end":return t.stop()}},t,e)}))()},shopCount:function(){var e=this;return c(a.a.mark(function t(){var n;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(i.k)();case 2:1===(n=t.sent).status&&(e.total=n.count);case 4:case"end":return t.stop()}},t,e)}))()},getShopCategory:function(){var e=this;return c(a.a.mark(function t(){var n;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(i.y)(31.22967,121.4762);case 2:n=t.sent,console.log(n),n.forEach(function(t){if(t.sub_categories.length){var n={value:t.name,label:t.name,children:[]};t.sub_categories.forEach(function(e,t){if(0===t)return!1;n.children.push({value:e.name,label:e.name})}),e.selectData.push(n)}});case 5:case"end":return t.stop()}},t,e)}))()},upData:function(e){var t=this;return c(a.a.mark(function n(){var o,s;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.editing=!0,o=t.selectCategory.join("/"),t.oldShopInfo.name!==e.name||t.oldShopInfo.address!==e.address||t.oldShopInfo.description!==e.description||t.oldShopInfo.phone!==e.phone||t.oldShopInfo.imagePath!==t.shopInfo.image_path||t.oldShopInfo.category!==o){n.next=9;break}return t.editing=!1,t.editDialog=!1,t.$message.success("您未做任何修改"),n.abrupt("return",!1);case 9:return n.next=11,Object(i.D)(e.id,e.name,e.address,e.description,parseInt(e.phone),t.shopInfo.image_path,o);case 11:s=n.sent,console.log(s),s.status?(t.editing=!1,t.getShopData(),t.$message.success(s.success),t.editDialog=!1):(t.editing=!1,t.editDialog=!1,t.$message.error(s.message));case 14:case"end":return n.stop()}},n,t)}))()},upImgSuccess:function(e,t){1===e.status?this.shopInfo.image_path=e.image_path:this.$message.error("上传图片失败")},uploadBefore:function(e){var t="image/jpeg"===e.type||"image/png"===e.type,n=e.size/1024/1024<2;return t||this.$message.error("上传头像图片只能是JPG格式"),n||this.$message.error("上传头像图片大小不能超过2MB"),t&&n}},watch:{limit:function(){this.getShopData()},pageNum:function(){this.getShopData()}},created:function(){this.shopCount()},mounted:function(){this.getShopData(),this.getShopCategory()}},p={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"homeRight"},[n("index-header"),e._v(" "),n("el-main",[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.shopData}},[n("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[n("el-form-item",{attrs:{label:"商品名称"}},[n("span",[e._v(e._s(t.row.name))])]),e._v(" "),n("el-form-item",{attrs:{label:"店铺地址"}},[n("span",[e._v(e._s(t.row.address))])]),e._v(" "),n("el-form-item",{attrs:{label:"店铺介绍"}},[n("span",[e._v(e._s(t.row.description))])]),e._v(" "),n("el-form-item",{attrs:{label:"店铺 ID"}},[n("span",[e._v(e._s(t.row.id))])]),e._v(" "),n("el-form-item",{attrs:{label:"联系电话"}},[n("span",[e._v(e._s(t.row.phone))])]),e._v(" "),n("el-form-item",{attrs:{label:"评分"}},[n("span",[e._v(e._s(t.row.rating))])]),e._v(" "),n("el-form-item",{attrs:{label:"销售量"}},[n("span",[e._v(e._s(t.row.recent_order_num))])]),e._v(" "),n("el-form-item",{attrs:{label:"分类"}},[n("span",[e._v(e._s(t.row.category))])])],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"店铺名称",prop:"name"}}),e._v(" "),n("el-table-column",{attrs:{label:"店铺地址",prop:"address"}}),e._v(" "),n("el-table-column",{attrs:{label:"店铺介绍",prop:"description"}}),e._v(" "),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(n){return e.editShop(t.row,t.$index)}}},[e._v("\n              编辑\n            ")]),e._v(" "),n("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(n){return e.removeShop(t.row,t.$index)}}},[e._v("\n              删除\n            ")]),e._v(" "),n("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(n){return e.replaceShop(t.row,t.$index)}}},[e._v("\n              添加食品\n            ")])]}}])})],1),e._v(" "),n("div",{staticClass:"m10"},[n("el-pagination",{attrs:{"current-page":e.indexPagination,"page-sizes":[50,100,200],"page-size":50,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.changeSize,"current-change":e.changeCurrent}})],1)],1),e._v(" "),n("index-footer"),e._v(" "),n("el-dialog",{attrs:{title:"修改店铺信息",visible:e.editDialog,width:"40%"},on:{"update:visible":function(t){e.editDialog=t}}},[n("el-form",{attrs:{model:e.shopInfo,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"店铺名称"}},[n("el-input",{model:{value:e.shopInfo.name,callback:function(t){e.$set(e.shopInfo,"name",t)},expression:"shopInfo.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"详细地址"}},[n("el-input",{model:{value:e.shopInfo.address,callback:function(t){e.$set(e.shopInfo,"address",t)},expression:"shopInfo.address"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"店铺介绍"}},[n("el-input",{model:{value:e.shopInfo.description,callback:function(t){e.$set(e.shopInfo,"description",t)},expression:"shopInfo.description"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"联系电话"}},[n("el-input",{model:{value:e.shopInfo.phone,callback:function(t){e.$set(e.shopInfo,"phone",t)},expression:"shopInfo.phone"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"店铺分类"}},[n("el-cascader",{attrs:{options:e.selectData,"change-on-select":"true"},model:{value:e.selectCategory,callback:function(t){e.selectCategory=t},expression:"selectCategory"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"商铺图片"}},[n("el-upload",{staticClass:"avatar-uploader",attrs:{action:"//elm.cangdu.org/v1/addimg/shop","show-file-list":!1,"on-success":e.upImgSuccess,"before-upload":e.uploadBefore}},[e.shopInfo.image_path?n("img",{staticClass:"avatar",attrs:{src:e.imgUrl+e.shopInfo.image_path}}):n("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{loading:e.editing,type:"primary"},on:{click:function(t){return e.upData(e.shopInfo)}}},[e._v("\n          "+e._s(e.editing?"修改中":"确定")+"\n        ")]),e._v(" "),n("el-button",{on:{click:function(t){e.editDialog=!1}}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var d=n("VU/8")(u,p,!1,function(e){n("u1/f")},null,null);t.default=d.exports},"u1/f":function(e,t){}});